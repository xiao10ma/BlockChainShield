(function(){let e;function t(){chrome.runtime.sendMessage({name:"test"},(t=>{if(t.success){console.log(t),clearInterval(e);var n={allowedTypes:"true"};document.dispatchEvent(new CustomEvent("yourCustomEvent",{detail:n}))}}))}function n(e,t){let n=this.document.createElement("div");n.id="xblock-label-tooltip",n.style.position="absolute",n.style.backgroundColor="#FFFFFF",n.style.left=e+10+"px",n.style.top=t+10+"px",n.style.border="solid 1px #bbbbbb",n.style.padding="2px",n.style.setProperty("height","auto","important");let s=this.document.createElement("img");s.src=chrome.runtime.getURL("assets/images/icon.png"),s.style.height="40px",s.style.width="40px",n.appendChild(s);let i=this.document.createElement("div");i.style.setProperty("display","inline-block"),n.appendChild(i);let o=this.document.createElement("p");o.innerText="地址标签：",o.style.setProperty("font-size","15px","important"),o.style.setProperty("font-weight","bold","important"),o.style.setProperty("line-height","1","important"),i.appendChild(o);let d=this.document.createElement("p");d.innerText="加载中",d.style.setProperty("font-size","14px","important"),d.style.setProperty("line-height","1","important"),i.appendChild(d);let r=this.document.createElement("p");r.innerText="",r.style.height="auto",r.style.setProperty("font-size","14px","important"),r.style.setProperty("line-height","20px","important"),r.style.setProperty("margin","5px","important"),n.appendChild(r);let l=this.document.createElement("span");l.innerText="钓鱼诈骗：",l.style.setProperty("font-weight","bold"),r.appendChild(l);let a=this.document.createElement("span");a.innerText="加载中",r.appendChild(a);let c=this.document.createElement("p");c.innerText="",c.style.height="auto",c.style.setProperty("font-size","14px","important"),c.style.setProperty("line-height","20px","important"),c.style.setProperty("margin","5px","important"),n.appendChild(c);let p=this.document.createElement("span");p.innerText="庞氏骗局：",p.style.setProperty("font-weight","bold"),c.appendChild(p);let h=this.document.createElement("span");return h.innerText="加载中",c.appendChild(h),n}function s(){document.addEventListener("readystatechange",(()=>{const e="js/inject.js",t=document.createElement("script");t.setAttribute("type","text/javascript"),t.src=chrome.extension.getURL(e),document.body.appendChild(t)}))}window.addEventListener("mouseup",(function(e){let t=window.getSelection().toString();if(0!=t.length){let s=this.document.querySelector("body"),i=n(e.pageX-200,e.pageY);t.startsWith("0x")&&42===t.length&&(s.appendChild(i),chrome.runtime.sendMessage({selectText:t},(function(){chrome.extension.onMessage.addListener((function(e,t,n){let s=e.length,o="";for(let i=0;i<s-1;i++)o=o?o+","+e[i]:e[i];const d=e[s-1].phish,r=e[s-1].ponzi;i.childNodes[1].childNodes[1].innerText=o?0==o.length?"NO LABEL":o:"NO LABEL",1===d?i.childNodes[2].childNodes[1].innerText="极低风险":2===d?i.childNodes[2].childNodes[1].innerText="较低风险":3===d?i.childNodes[2].childNodes[1].innerText="中等风险":4===d?i.childNodes[2].childNodes[1].innerText="较高风险":5===d&&(i.childNodes[2].childNodes[1].innerText="极高风险"),1===r||-1===r?i.childNodes[3].childNodes[1].innerText="极低风险":2===r?i.childNodes[3].childNodes[1].innerText="较低风险":3===r?i.childNodes[3].childNodes[1].innerText="中等风险":4===r?i.childNodes[3].childNodes[1].innerText="较高风险":5===r&&(i.childNodes[3].childNodes[1].innerText="极高风险"),n&&n("yes this from content")}))})))}})),window.addEventListener("mousedown",(function(){let e=this.document.getElementById("xblock-label-tooltip");if(e){let t=this.document.querySelector("body");t.removeChild(e)}})),window.addEventListener("message",(function(n){if(n.data)return void(n.data.sign?chrome.runtime.sendMessage({sign:"sign"},(function(n){console.log(n),e=setInterval(t,100)})):n.data.approve?chrome.runtime.sendMessage({approve:"1"},(function(n){console.log(n),e=setInterval(t,100)})):n.data.address&&chrome.runtime.sendMessage({address:n.data.address},(function(n){console.log(n),e=setInterval(t,100)})));const s=n.data;if("metamask-contentscript"===s.target){const e=s.data.data,t=e.method;if("eth_sendTransaction"===t){let t=e.params[0].to,n=e.params[0].data;n.startsWith("0x095ea7b3")||n.startsWith("0x39509351")||n.startsWith("0xa22cb465")?chrome.runtime.sendMessage({approve:"1"},(function(e){console.log(e)})):chrome.runtime.sendMessage({address:t},(function(e){console.log(e)}))}else if("eth_signTypedData_v3"===t||"eth_signTypedData_v4"===t){const[t]=e.params??[];JSON.parse(t)}else"eth_sign"!==t&&"personal_sign"!==t||chrome.runtime.sendMessage({sign:"sign"},(function(e){console.log(e)}))}}),!1),s()})();